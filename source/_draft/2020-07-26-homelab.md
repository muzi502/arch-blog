---
title: ç¿»è½¦ï¼åƒåœ¾ä½¬çš„ Homelab æŠ˜è…¾è®°å½•
date: 2020-07-26
updated:
slug:
categories:
tag:
copyright: true
comment: true
---

## æ¡åƒåœ¾

ä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œç™½å¤©åœ¨å·¥åœ°ä¸Šæ¬ç –å…»å®¶ç³Šå£ï¼Œæ™šä¸Šä¸‹ç­å›å®¶åå°±å¼€å§‹æŠ˜è…¾ä¸€å †ç ´é“œçƒ‚é“è‡ªå¨±è‡ªä¹ğŸ˜‚ã€‚æœ€è¿‘ä¸œæ‹¼è¥¿å‡‘èŠ±äº† 2000 æ¥å—é’±æ¡åƒåœ¾æ•´äº†å° homelab ç©ç©ï¼ŒæŠ˜è…¾ä¸€äº›æ²¡ç”¨çš„ä¸œè¥¿ğŸ™ƒ

å…¶å®å¾ˆæ—©ä¹‹å‰å°±æƒ³æä¸€å°ä½åŠŸè€—çš„ HomeLab ä¸»æœºç©å„¿äº†ï¼Œæœ€æ—©å¼€å§‹é€‰æ‹©çš„æ˜¯ Dell T1700 SFF + E3-1271V3 +32GB DDR3ï¼Œä½†æ˜¯å‘¢ï¼ŒE3 V3 ç³»åˆ—æ˜¯ Intel ç¬¬å››ä»£  CPU ï¼Œ1150 èŠ¯ç‰‡ç»„æ— æ³•ä» M.2 å¯åŠ¨ï¼Œç£ç›˜é€Ÿåº¦åªèƒ½è¾¾åˆ° SATA III ä¹Ÿå°±æ˜¯é¡¶å¤š 600 MB/s çš„è¯»å†™é€Ÿåº¦ï¼Œè€Œç›®å‰éšä¾¿ä¸€å—æ”¯æŒ  PCI-e M.2 NVMe çš„ä¸»æ¿æ™®ééƒ½èƒ½è¾¾åˆ° 3000MB/s äº†ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹æ¥è®² E3 V3 å·²ç»ä¸å€¼å¾—æ¡äº†ã€‚è€Œä¸”æˆ‘æƒ³æŠŠæˆ‘å°å¼æœºä¸Š SN750 500GB æ¢åˆ°è¿™å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PCI-e M.2 NVMe çš„ä¸»æ¿ã€‚

| ç¡¬ä»¶ | é…ç½®                                         | ä»·æ ¼ |
| :--: | -------------------------------------------- | :--: |
| CPU  | Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz 35w | 480  |
| ä¸»æ¿ | Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼šIntel Â®Q170       | 400  |
| å†…å­˜ | é•å…‰ DDR4 16GB 2666MHz                       | 310  |
| æ˜¾å¡ | è‹±ç‰¹å°”Â® æ ¸èŠ¯æ˜¾å¡ 530                         |  0   |
| æœºç®± | Dell OptiPlex 7040 å‡†ç³»ç»Ÿ                    |  0   |
| ç”µæº | Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼š290W å¼€å…³ç”µæº     |  0   |
| UPS  | æŸæ‚ç‰Œ UPS 650VA360W                         | 160  |
| å›ºæ€ | ä¸‰æ˜Ÿ 970PRO 512GB                            | 820  |
| æ€»ä»· |                                              | 2170 |

å…¶å®æœ¬æ¥çš„é¢„ç®—ä¸‰æ˜Ÿ 970PRO 512GBæ²¡æ‰“ç®—ä¹°ï¼Œæ˜¯æˆ‘åœ¨æ‰¾ Dell OptiPlex 7040 æ—¶æ„å¤–ç¢°åˆ°çš„ä¸€ä¸ªè€å“¥ï¼Œè€Œä¸”è¿™å—å›ºæ€æ˜¯å¾·äºšçš„ï¼Œè¿˜ç®—é è°±ä¸€äº›ï¼Œäºæ˜¯å‰æ‰‹ä¹°äº†è¿™ä¸ªå—å›ºæ€ã€‚970PRO ç³»åˆ—çš„éƒ½æ˜¯ MLC çš„é¢—ç²’çš„å›ºæ€ç¡¬ç›˜ï¼Œé€š SM961 ä¸€æ ·æ˜¯å±äºä¼ å®¶å®ç³»åˆ—ğŸ˜‚ï¼Œä½†æ˜¯ SM961 æ·˜å®ä¸Šæ°´å¤ªæ·±ï¼Œæ¸…é›¶ç›˜å æ®å¤šæ•°ï¼Œæ‰€ä»¥ä¸å»ºè®®ä¹°ã€‚

æ­£å¥½æŠŠè¿™å— 970PRO æ¢åˆ°æˆ‘çš„å°å¼æœºä¸Šï¼ŒæŠŠå°å¼æœºä¸Šçš„ SN750 512GB æ¢åˆ° HomeLab æœºå™¨ä¸Šï¼Œç»™ ESXi ä¸Šçš„è™šæ‹Ÿæœºç”¨ã€‚åœ¨ç©å„¿è™šæ‹ŸåŒ–çš„æ—¶å€™æ·±æœ‰æ„Ÿè§¦ï¼Œå®¿ä¸»æœºçš„ç£ç›˜æ˜¯æœºæ¢°ç¡¬ç›˜çš„è¯ï¼Œä¸Šé¢çš„è™šæ‹Ÿæœºè¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¾ˆå¡ï¼Œæ‰€ä»¥ç© ESXi è™šæ‹ŸåŒ–ï¼Œæœ‰å—å›ºæ€çš„ä½“éªŒæ˜¯éå¸¸çˆ½æ»´ğŸ˜‹ã€‚

è‡³äº 6600T çš„æ€§èƒ½ï¼Œåœ¨ 500 å—é’±çš„ä»·ä½å†… 35Wä½åŠŸè€—çš„ 6600T è¿˜ç®—å¯ä»¥èƒ½æ¥å—ï¼Œä¸ºä»€ä¹ˆä¸ä¹° 7200U è¿™ç§ä½å‹ U å‘¢ï¼Ÿï¼Œä¸€æ˜¯ä½å‹ U çš„è£…æœºæˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æ€§ä»·æ¯”å¾ˆä½ï¼Œæˆ‘è¿˜è¦åœ¨ä¸Šé¢è·‘ä¸€å †è™šæ‹Ÿæœºï¼Œä½å‹ U ææ€•æ‰›ä¸ä½ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ä½å‹ U çš„è£…æœºæ–¹æ¡ˆã€‚

![](img/homelab-1.jpg)

## è£…æœº

å…¶å®è£…æœºå¾ˆå¿«ï¼Œç”±äºæ˜¯ä¹°çš„ Dell OptiPlex 7040 å‡†ç³»ç»Ÿï¼Œæ‰€ä»¥åªéœ€è¦æŠŠ CPU ã€å†…å­˜ã€ç¡¬ç›˜è£…ä¸Šå»å°±å®Œäº‹å„¿äº†ã€‚

æ”¶åˆ°å‡†ç³»ç»Ÿåå‘ç°æ²¡æœ‰å¸¦ M.2 èºä¸ï¼Œåªèƒ½ä¸´æ—¶æ‹¿èƒ¶å¸¦ç²˜ç³Šä¸Šå»ï¼Œå‹‰å¼ºæ’‘äº†ä¸¤å¤©ï¼Œåæ¥ä¹°äº†ä¸ªèºä¸å’Œæ•£çƒ­ç‰‡å®Œç¾åœ°è§£å†³äº†ã€‚

![](img/homelab-5.jpg)

ä»ä»¥å‰æ—§ç¬”è®°æœ¬æ·˜æ±°ä¸‹æ¥çš„ 2TB 5400RPM çš„çŸ³å¤´ç›˜ï¼Œå·²ç»å‡ºç°åé“äº†ï¼Œä¸´æ—¶å½“ä¸ªä¸‹è½½ç›˜å§ï¼Œåœ¨å®ƒè¿˜æ²¡å½»åº•å´©ç›˜ä¹‹å‰å†å‹æ¦¨ä¸€ä¸‹å®ƒå§ğŸ˜‚ã€‚åé¢æ‰“ç®—å†æ·»åŠ ä¸€å—12TBçš„æ°¦æ°”ç›˜å½“ä»“åº“ç›˜å’Œå¤‡ä»½æ•°æ®ä½¿ç”¨ï¼Œæœ‰äº† UPS å’Œè¿™å°ä¸»æœº 7*24 å°æ—¶å¼€æœºä¹Ÿæ²¡å•¥é—®é¢˜äº†ã€‚

![](img/homelab-3.jpg)

åé¢é‚£å°æ˜¯æˆ‘çš„å°å¼æœºï¼Œä¹Ÿæ˜¯å»å¹´è¿™æ—¶å€™ä¹°çš„ï¼Œä¸¤è€…æ¯”è¾ƒèµ·æ¥ SFF çš„å‹å·ç¡®å®å°å¾ˆå¤šã€‚Dell çš„è¿™ç§ä¸»æœºè¿˜æœ‰ä¸€ç§ MFF å‹å·çš„ï¼Œé‚£ç§æ›´å°ä¸€äº›ï¼Œå·®ä¸å¤šæ¯”è·¯ç”±å™¨å¤§ä¸€äº›è€Œå·²ï¼Œä¸è¿‡æ‰©å±•æ€§ä¸å¥½ï¼Œè€Œä¸”è¿˜éœ€è¦å¤–ç½®ç”µæºï¼Œä¹Ÿå°±æ²¡è€ƒè™‘ï¼Œä¸è¿‡ç°åœ¨æƒ³æƒ³æœ‰ç‚¹åæ‚”äº†ï¼Œå½“åˆåº”è¯¥å¤šåŠ ç‚¹é’±ä¹° SFF çš„ï¼Œä¸è¿‡è¿˜å¥½ä¹Ÿèƒ½æ¥å—ï¼Œåªä¸è¿‡ä½“ç§¯å¤§äº†äº›ï¼Œæ¬å®¶çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚

![](img/homelab-4.jpg)



[](img/homelab-6.jpg)



[](img/homelab-2.jpg)

## ESXi

### Ubuntu 20.04

é¡ºå¸¦ç”¨ [ZBench](https://github.com/Aniverse/ZBench) æµ‹äº†ä¸€ä¸‹è™šæ‹Ÿæœºçš„ç£ç›˜æ€§èƒ½ï¼Œè¿˜ç®—å‹‰å¼ºè¯´çš„è¿‡å»ã€‚

```ini
--------------------------------------------------------------------------
CPU model            : Intel(R) Core(TM) i5-6600T CPU @ 2.70GHz
Number of cores      : 4
CPU frequency        : 2712.000 MHz
Total size of Disk   : 33.3 GB (7.7 GB Used)
Total amount of Mem  : 3935 MB (306 MB Used)
Total amount of Swap : 3934 MB (0 MB Used)
System uptime        : 4 days, 19 hour 47 min
Load average         : 0.13, 0.08, 0.03
OS                   : Ubuntu 20.04 LTS
Arch                 : x86_64 (64 Bit)
Kernel               : 5.4.0-42-generic
Virt                 : vmware
--------------------------------------------------------------------------
I/O speed(1st run)   :1.3 GB/s
I/O speed(2nd run)   :1.3 GB/s
I/O speed(3rd run)   :1.3 GB/s
```

### PhotonOS

### Alpine

### Windows

### NFS

ä¸»è¦ç”¨æ¥ç»™æˆ‘çš„ Pod æŒä¹…åŒ–å­˜å‚¨æŒ‚ PVC ä½¿ç”¨ã€‚

### Debian

## é¢å¤–ç¡¬ä»¶

### UPS

ç”±äºæœ€è¿‘æˆ¿ä¸œå®¶é‡Œç»å¸¸æ–­ç”µï¼Œæœ‰æ—¶ä¸€å¤©æ–­ç”µå…«ä¹æ¬¡ï¼Œæ¯æ¬¡æ–­ç”µæˆ‘éƒ½æ‹…å¿ƒç€ç¡¬ç›˜é‡Œçš„è€å©†ä»¬ä¼šä¸ä¼šæŒ‚æ‰ï¼Œç´¢æ€§è¿˜æ˜¯ä¹°äº† UPS ï¼Œåœ¨é©¬äº‘å®¶çœ‹äº†çœ‹ï¼Œå¸¦ç»™ NAS è‡ªåŠ¨æ–­ç”µçš„ UPS æ™®éåœ¨ 400å—é’±ä»¥ä¸Šï¼Œè€Œä¸”æˆ‘è¿™ä¸ªè¿˜æ˜¯ä¸ªå‡çš„ NAS ï¼ŒUPS ä¸Šçš„ USB å£ä¸ä¸€å®šæ”¯æŒæˆ‘çš„ä¸»æœºã€‚æœ€åä¸ºäº†èŠ‚çœä¸€ä¸‹é¢„ç®—èŠ±å„¿ 160 å—é’±ä¹°äº†ä¸ªä¸æ”¯æŒ USB çš„ UPS ï¼Œä½†æ˜¯åˆä¸èƒ½æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®¶é‡Œçš„ 220V å¸‚ç”µæ–­ç”µä¹‹åï¼ŒUPS çš„ç”µé‡åªèƒ½ç»™ä¸»æœºç»­å‘½ 10~20min å·¦å³ï¼ŒUPS çš„ç”µé‡ç”¨å®Œä¹‹åå°±å—å±äº†ï¼Œç…§é˜³è¿˜æ˜¯æ–­ç”µã€‚æ‰€ä»¥åœ¨ UPS ç”¨å°½ç”µé‡è¿˜æ˜¯æ²¡æœ‰æ¥ç”µä¹‹å‰ï¼Œä¸€å®šè¦æƒ³åŠæ³•æŠŠä¸»æœºé€šè¿‡ poweroff çš„æ–¹å¼å®‰å…¨ä¼˜é›…æ»´å…³æœºã€‚

é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ€ä¹ˆçŸ¥é“ 220V å¸‚ç”µæ–­ç”µäº†ï¼Œèµ·åˆæƒ³æœ‰æ²¡æœ‰ä¸ª 220V çš„ä¼ æ„Ÿå™¨ï¼Œæˆ‘å»ï¼Œæœ‰ç‚¹éš¾åº¦è¿˜æ˜¯ç®—äº†å§ã€‚æœ€åä¸€æƒ³ï¼Œå¯ä»¥é€šè¿‡ ping æˆ¿ä¸œå®¶å…‰çŒ«çš„æ–¹å¼ã€‚æˆ‘çš„è·¯ç”±å™¨å’Œä¸»æœºç­‰è®¾å¤‡è¿æ¥ UPS ï¼Œæˆ¿ä¸œå®¶çš„å…‰çŒ«å¹¶æ²¡æœ‰è¿æ¥ UPS ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿå» ping æˆ¿ä¸œå®¶çš„å…‰çŒ«ï¼Œæ²¡æœ‰ ping é€šè¯´æ˜å°±æ˜¯æ–­ç”µäº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç½‘çº¿è¢«æ‹”æ‰äº†ï¼Œä½†æ¦‚ç‡å¾ˆå°ã€‚`! ping -c 8 A && ssh B "poweroff"` ä¸€è¡Œç®€å•çš„å‘½ä»¤å°±æ»¡è¶³äº†æˆ‘çš„éœ€æ±‚ï¼Œ

```shell
#!/bin/sh
echo "start" >> /tmp/power_status
if ! ping -c 32 192.168.1.1
then
    sleep 300
    ping -c 32 192.168.1.1 && exit 0
    sshpass -p "pwd" ssh root@192.168.0.210 "net rpc shutdown -I 192.168.0.240 -U admin%poweroff"
    sshpass -p "pwd" ssh root@192.168.0.200 "sh -c /suspend_vm.sh"
    echo "220v poweroff" >> /tmp/power_status
fi
```

å¯¹äº ESXi ä¸Šçš„è™šæ‹Ÿæœºï¼Œè¿˜æ˜¯é‡‡ç”¨äº†æŒ‚èµ·çš„æ–¹å¼ï¼Œå°†è™šæ‹Ÿæœºçš„å†…å­˜çŠ¶æ€ä¿å­˜åœ¨æ•°æ®å­˜å‚¨çš„ç£ç›˜é‡Œï¼Œè¿™æ ·é‡æ–°å¼€å¯è™šæ‹Ÿæœºåå°±èƒ½æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹åƒ Windows çš„ä¼‘çœ ã€‚

```shell
#!/bin/sh
for vm in $(/sbin/vmdumper -l | grep -v Alpine |  awk '{print $1}' | sed 's/wid=//g')
do
     /sbin/vmdumper ${vm} suspend_vm
done
```

### è¿œç¨‹å¼€å…³

