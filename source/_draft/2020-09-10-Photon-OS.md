---
title: å®¹å™¨ä¼˜åŒ–å‹ Linux å‘è¡Œç‰ˆ Photon OS 
date: 2020-09-10
updated: 2020-09-12
slug:
categories: æŠ€æœ¯
tag:
  - å®¹å™¨
  - PhotonOS
  - Linux
copyright: true
comment: true
---

## Linux container OS ?

### GKE çš„ [Container-Optimized OS](https://cloud.google.com/container-optimized-os/docs/)

Kubernetes çš„äº²çˆ¸çˆ¸ Google å®¶çš„ [Google Kubernetes Engine](https://cloud.google.com/kubernetes-engine) å³ GKE é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä½¿ç”¨ [Container-Optimized OS](https://cloud.google.com/container-optimized-os/docs/) æ¥è¿è¡Œå·¥ä½œè´Ÿè½½ï¼Œä¸è¿‡ä»…ä»…æ˜¯é’ˆå¯¹ GCE æ¥è¿›è¡Œä¼˜åŒ–çš„ï¼Œå¯èƒ½åœ¨ OpenStack æˆ–è€… vSphere ä¸Šè¿è¡Œä¸èµ·æ¥ï¼Œ(ççŒœğŸ˜‚ã€‚

>   Container-Optimized OS æ˜¯é€‚ç”¨äº [Compute Engine](https://cloud.google.com/compute) è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸“ä¸ºè¿è¡Œ Docker å®¹å™¨è€Œä¼˜åŒ–ã€‚å€ŸåŠ© Container-Optimized OSï¼Œæ‚¨å¯ä»¥å¿«é€Ÿã€é«˜æ•ˆã€å®‰å…¨åœ°åœ¨ Google Cloud Platform ä¸Šå¯åŠ¨ Docker å®¹å™¨ã€‚Container-Optimized OS ç”± Google ç»´æŠ¤ï¼ŒåŸºäº [Chromium OS](https://www.chromium.org/chromium-os) å¼€æ”¾æºä»£ç é¡¹ç›®ã€‚

ç‰¹ç‚¹å°±æ˜¯ä¸åŒäºå…¶ä»–çš„ Linux å‘è¡Œç‰ˆï¼Œè¿™ä¸ªæ˜¯åŸºäº [Chromium OS](https://www.chromium.org/chromium-os) å®šåˆ¶åŒ–å¼€å‘çš„ï¼Œå¯¹å†…æ ¸ç‰ˆæœ¬é€‰ç”¨çš„ä¹Ÿæ¯”è¾ƒæ¿€è¿›ï¼Œæ¸…ä¸€è‰² `4.19.112+` æˆ–è€… `5.x` ç‰ˆæœ¬ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†æ‹…å¿ƒåƒ CentOS 7.x ç³»åˆ—é‚£æ ·å„ç§å†…æ ¸ bug äº†ğŸ˜‚ã€‚Chromium OS å°±æ˜¯ Google åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Google ä¹Ÿæœ‰è¿™ä¸ªå®åŠ›é’ˆå¯¹è‡ªå®¶çš„ GCP äº‘å¹³å°è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ä¸ª OS å‡ºæ¥ï¼Œä¸“é—¨ç»™ kubernetes é›†ç¾¤è¿è¡Œä½¿ç”¨ã€‚

```yaml
apiVersion: v1
items:
- apiVersion: v1
  kind: Node
  metadata:
    annotations:
      container.googleapis.com/instance_id: ""
      node.alpha.kubernetes.io/ttl: "0"
      node.gke.io/last-applied-node-labels: cloud.google.com/gke-nodepool=default-pool,cloud.google.com/gke-os-distribution=cos
      volumes.kubernetes.io/controller-managed-attach-detach: "true"
    creationTimestamp: "2020-09-07T00:12:41Z"
    labels:
      beta.kubernetes.io/arch: amd64
      beta.kubernetes.io/instance-type: e2-medium
      beta.kubernetes.io/os: linux
      cloud.google.com/gke-nodepool: default-pool
      cloud.google.com/gke-os-distribution: cos
      failure-domain.beta.kubernetes.io/region: asia-southeast1
      failure-domain.beta.kubernetes.io/zone: asia-southeast1-a
      kubernetes.io/arch: amd64
      kubernetes.io/hostname: gke-cluster-1-default-pool
      kubernetes.io/os: linux
    name: gke-cluster-1-default-pool
    resourceVersion: "47450"
    selfLink: /api/v1/nodes/gke-cluster-1-default-pool
    uid:
  spec:
    podCIDR: 10.112.2.0/24
    podCIDRs:
    - 10.112.2.0/24
    providerID: gce:
  status:
    allocatable:
      attachable-volumes-gce-pd: "15"
      cpu: 940m
      ephemeral-storage: "47093746742"
      hugepages-2Mi: "0"
      memory: 2897956Ki
      pods: "110"
    capacity:
      attachable-volumes-gce-pd: "15"
      cpu: "2"
      ephemeral-storage: 98868448Ki
      hugepages-2Mi: "0"
      memory: 4043812Ki
      pods: "110"
    conditions:
    daemonEndpoints:
      kubeletEndpoint:
        Port: 10250
    nodeInfo:
      architecture: amd64
      bootID: 0c517083-aaf6-75fc4b2204ba
      containerRuntimeVersion: docker://19.3.1
      kernelVersion: 4.19.112+
      kubeProxyVersion: v1.16.13-gke.1
      kubeletVersion: v1.16.13-gke.1
      machineID: 33a96ff3203d88c0a542
      operatingSystem: linux
      osImage: Container-Optimized OS from Google
      systemUUID: 33a96ff33d88c0a542
```

ä¹‹å‰çœ‹åˆ°çš„ [New GKE Dataplane V2 increases security and visibility for containers](https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine)

### AWS çš„ [Bottlerocket OS](https://github.com/bottlerocket-os/bottlerocket)

è¿™ä¸ªæ˜¯ AWS æœ€è¿‘å¼€æºçš„

>   ### Optimized performance through AWS integrations
>
>   AWS provided builds of Bottlerocket are optimized to run on Amazon EC2 and include support for the latest Amazon EC2 instance capabilities. They also have built-in integrations with AWS services for container orchestration, registries, and observability.

### çº¢å¸½çš„ [RHCOS](https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html)

æ¥è‡ªçº¢å¸½å­å®¶çš„ [Red Hat Enterprise Linux CoreOS (RHCOS)](https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html)ï¼Œä¸è¿‡è¿™ä¸ª OS ä»…ä»…é€‚ç”¨äºå®ƒè‡ªå®¶çš„ [OpenShift](https://docs.openshift.com/)ï¼Œè€Œä¸”å®¹å™¨è¿è¡Œæ—¶ä»…æ”¯æŒ CRI-Oã€‚

>   At the moment, CRI-O is only available as a container engine within OpenShift Container Platform clusters.

### CoreOS Container Linux

ä¸ªäººè®¤ä¸º CoreOS çš„ CoreOS Container Linux è¦æ¯” Container-Optimized OS å’Œ Photon OS è¦æ›´åŠ ä¸“ä¸šï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å®¹å™¨æ¥è®²ï¼Œ CoreOS å°±æ˜¯ä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨çš„ï¼Œå®ƒæ²¡æœ‰åƒ yum æˆ– apt è¿™æ ·çš„åŒ…ç®¡ç†å™¨æ¥å®‰è£…è½¯ä»¶ï¼Œåœ¨ CoreOS ä¸­ä½ ä¸éœ€è¦å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½è¦ä½¿ç”¨ docker æ¥æ‰“åŒ…ã€‚

>   é¢å¤–æä¸€å¥ï¼ŒCoreOS æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œç°å¦‚ä»Šå·²ç»è¢« Red HatÂ® æ”¶è´­äº†ï¼Œè€Œ Red HatÂ® å·²ç»è¢« IBM æ”¶è´­äº†ï¼ŒæŒ‰ç…§å…³ç³»æ¥è®²è€Œ CoreOS åº”è¯¥æ˜¯ IBM çš„å­™å­å§ğŸ™ƒã€‚è€Œ CoreOS Container Linux ä»…ä»…æ˜¯ä»–ä»¬ç»´æŠ¤é¡¹ç›®çš„å…¶ä¸­ä¸€ä¸ªï¼ŒCoreOS å¼€æºçš„é¡¹ç›®è¿˜æœ‰ï¼š
>
>   -   etcdï¼š
>   -   Clair:
>   -   dexï¼š
>   -   Prometheusï¼š
>   -   flannelï¼š

åœ¨ Linux ä¸–ç•Œé‡Œæœ‰å¤§é‡çš„å‘è¡Œç‰ˆå¯ä»¥åšä¸ºæœåŠ¡å™¨ç³»ç»Ÿä½¿ç”¨ï¼Œä½†æ˜¯è¿™äº›ç³»ç»Ÿå¤§å¤šéƒ¨ç½²å¤æ‚,ï¼Œæ›´æ–°ç³»ç»Ÿæ›´æ˜¯å›°éš¾é‡é‡. è¿™äº›éƒ½æ˜¯ CoreOS è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚



-   æœ€å°åŒ–çš„æ“ä½œç³»ç»Ÿï¼š å ç”¨å†…å­˜å¾ˆå°‘ï¼Œæ¯”å…¸å‹çš„æœåŠ¡å™¨ç‰ˆæœ¬ Linux å°‘å  40%çš„å†…å­˜ã€‚
-   æ˜“äºå‡çº§ï¼š CoreOS é‡‡ç”¨åŒç³»ç»Ÿåˆ†åŒºï¼ˆä¸»åŠ¨åˆ†åŒº/è¢«åŠ¨åˆ†åŒºï¼‰è®¾è®¡è€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„é€šè¿‡å‡çº§åŒ…æ¥å‡çº§ç³»ç»Ÿï¼Œè¿™ä½¿å¾—æ¯æ¬¡å‡çº§æ›´åŠ å¿«é€Ÿï¼Œå¯é å’Œæ˜“äºå›æ»šã€‚
-   é›†æˆ Dockerï¼š CoreOS é»˜è®¤é›†æˆ Docker å¹¶ä½œäº†å¾ˆå¥½çš„æ”¯æŒå’Œä¼˜åŒ–ï¼Œçœå»ç”¨æˆ·å®‰è£…ï¼Œé…ç½®ï¼Œä¼˜åŒ– Docker çš„æ—¶é—´ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ç”¨æˆ·ã€‚
-   æ˜“äºé›†ç¾¤åŒ–ï¼š CoreOS æœ¬èº«æä¾›äº†å¤§å‹ Docker å®¹å™¨é›†ç¾¤çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å†…ç½®çš„ fleet å·¥å…·åœ¨å¤šå°ç³»ç»Ÿä¸­éƒ¨ç½²å®¹å™¨å¹¶è¿›è¡Œé›†ç¾¤åŒ–ç®¡ç†ã€‚åŒæ—¶é€šè¿‡æä¾› Discovery Serviceï¼Œä¾¿äºåŠ¨æ€éƒ¨ç½²å’Œç®¡ç†é›†ç¾¤ï¼Œè§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€‚
-   è‡ªåŠ¨åŒ–çš„å¤§è§„æ¨¡éƒ¨ç½²ï¼š CoreOS è‡ªèº«æä¾›çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿè‡ªåŠ¨åœ°å¤§è§„æ¨¡æ‰¹é‡éƒ¨ç½²å¹¶æ“ä½œç³»ç»Ÿï¼Œæå¤§åœ°å‡å°‘ç”¨æˆ·å·¥ä½œé‡ã€‚
-   ä½¿ç”¨ systemd åšä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œsystemd æœ‰ç°ä»£åŒ–çš„æ—¥å¿—åŠŸèƒ½ï¼ŒåŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡.

### RancherOS

RancherOS æ˜¯ Rancher å›¢é˜Ÿæ‰€ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹æ ‡ CoreOS ä¸€æ ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆè‡³å°‘å®˜æ–¹åšäº†è¿™ä¹ˆæ ·çš„æ‰¿è¯ºï¼Œå’±ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç”¨è¿‡ï¼Œä¸å¥½è¯´ã€‚åœ¨ RancherOS ä¸­æ‰€æœ‰çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæ‰€æœ‰çš„æœåŠ¡ï¼Œæ¯”å¦‚ udev å’Œ syslogï¼‰éƒ½æ˜¯ç”¨ docker æ¥ç®¡ç†ï¼Œè¿™ä¸€ç‚¹è¦æ¯” CoreOS æ›´åŠ æ¿€è¿›ä¸€äº›ï¼Œè€Œ CoreOS è¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­çš„ systemd æ¥ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡ã€‚é€šè¿‡ç§»é™¤ä¼ ç»Ÿ Linux å‘è¡Œç‰ˆä¸­ä¸å¿…è¦çš„æœåŠ¡å’Œåº“æ¥æœ€å°åŒ–ç³»ç»Ÿï¼Œä½¿ä»–ä¸“æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œå³è¿è¡Œ docker å®¹å™¨ã€‚

`Everything in RancherOS is a Docker container.` æ„Ÿè§‰è¿™ä¸ªè¦æ¯” CoreOS æ›´åŠ å®¹å™¨åŒ–ï¼Œç”šè‡³ä½¿ç”¨ docker å–ä»£äº† systemd æ¥ç®¡ç†ç³»ç»Ÿçš„å„ç§æœåŠ¡ã€‚ç³»ç»Ÿå¯åŠ¨åè¿è¡Œä¸¤ä¸ª docker æœåŠ¡è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿ docker ï¼Œåœ¨æ­¤ä¹‹ä¸Šåœ¨è¿è¡Œç³»ç»ŸæœåŠ¡å®¹å™¨ï¼Œå’Œç”¨æˆ·å±‚é¢çš„ docker ã€‚ä¸è¿‡çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™å¼ å›¾ä½ å°±ä¼šæ˜ç™½ã€‚æ€»çš„æ¥è®² RancherOS æ˜¯ä½¿ç”¨ docker æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡çš„ï¼ŒåŒ…æ‹¬ç”¨æˆ·å±‚é¢çš„ docker ã€‚

![How it works](img/rancheroshowitworks.png)

### VMware çš„ [Photon OS](https://vmware.github.io/photon/)

ä»Šå¤©çš„ä¸»è§’ï¼ŒVMware  å¼€æºçš„ Photon OSï¼Œè™½ç„¶è¿™ä¸ª OS ä½ å¯èƒ½æ²¡å¬è¯´è¿‡ï¼Œä½† VMware å¼€æºçš„ Harbor æƒ³å¿…å¾ˆç†Ÿæ‚‰ï¼Œè€Œ Harbor çš„åŸºç¡€é•œåƒä½¿ç”¨çš„å°±æ˜¯ä»–å®¶çš„ Photon OSğŸ˜‚ã€‚

```ini
root [ /harbor ]# cat /etc/os-release
NAME="VMware Photon OS"
VERSION="2.0"
ID=photon
VERSION_ID=2.0
PRETTY_NAME="VMware Photon OS/Linux"
ANSI_COLOR="1;34"
HOME_URL="https://vmware.github.io/photon/"
BUG_REPORT_URL="https://github.com/vmware/photon/issues"
root [ /harbor ]
```

åœ¨ Photon OS çš„æ„å»ºè„šæœ¬ [build.py](https://github.com/vmware/photon/blob/master/build.py) ä¸­å¯ä»¥çœ‹åˆ°å®ƒæ„å»ºçš„äº§ç‰©æ”¯æŒ ISO å’Œ docker é•œåƒï¼Œä»¥åŠä¼—å¤šå…¬æœ‰äº‘çš„è™šæ‹Ÿæœºæ ¼å¼ï¼Œä¸¤è€…éƒ½æ˜¯æ¥è‡ªç›¸åŒçš„æºç ï¼Œåªä¸è¿‡æ„å»ºå‡ºæ¥çš„å½¢å¼ä¸åŒè€Œå·²ã€‚

```json
targetList = {
        "image":["iso", "ami", "gce", "azure", "rpi3", "ova", "ova_uefi", "all", "src-iso",
                "photon-docker-image", "k8s-docker-images", "all-images", "minimal-iso", "rt-iso"],

        "rpmBuild": ["packages", "packages-minimal", "packages-initrd", "packages-docker",
                "updated-packages", "tool-chain-stage1", "tool-chain-stage2", "check",
                "ostree-repo", "generate-yaml-files", "create-repo", "distributed-build"],

        "buildEnvironment": ["packages-cached", "sources", "sources-cached", "publish-rpms",
                "publish-x-rpms", "publish-rpms-cached", "publish-x-rpms-cached", "photon-stage"]
```

![](img/20191231163325900.png)

![](img/20191231163400135.png)

å‰½çªƒä¸€æ®µ VMware å®˜æ–¹çš„[æ–‡æ¡£](https://vmware.github.io/photon/)ä»‹ç»ï¼š

>   Project Photon OSâ„¢ is an open source, minimal Linux container host that is optimized for cloud-native applications, cloud platforms, and VMware infrastructure. Photon OS 3.0 introduces ARM64 support, installer improvements and updated packages. We invite partners, customers, and community members to collaborate on using Photon OS to run high-performance virtual machines and containerized applications.
>
>   -   **Optimized for VMware vSphereÂ®**: The Linux kernel is tuned for performance when Photon OS runs on vSphere.
>   -   **Support for containers**: Photon OS includes the Docker daemon and works with container orchestration frameworks, such as Mesos and Kubernetes.
>   -   **Efficient lifecycle management**: Photon OS is easy to manage, patch, and update.
>   -   **Security hardened**: The kernel and other aspects of the operating system are built with an emphasis on security.
>
>   For more information, see the [datasheet](https://vmware.github.io/photon/assets/files/photon-os-datasheet.pdf).
>
>   Track our progress in earning the Linux Foundationâ€™s Core Infrastructure Initiativeâ€™s Best Practices Badge.

å¯ä»¥çœ‹å‡º Photon OSâ„¢ æ˜¯é’ˆå¯¹ VMware vSphereÂ® è™šæ‹ŸåŒ–å¹³å°è¿›è¡Œå†…æ ¸ä¼˜åŒ–çš„å®¹å™¨ä¸“ç”¨æ“ä½œç³»ç»Ÿï¼Œå°±å’Œ CoreOS ä¸€æ ·ã€‚ååˆ†é€‚åˆä¸“é—¨ç”¨æ¥è¿è¡Œå®¹å™¨ï¼Œå½“ä½œ Kubernetes é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½è¿è¡ŒèŠ‚ç‚¹æ¥ä½¿ç”¨ï¼Œè½»é‡çš„ç³»ç»Ÿï¼Œå¯¹é›†ç¾¤è§„æ¨¡è¿›è¡ŒåŠ¨æ€æ‰©ç¼©å®¹ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚

## å®‰è£…

### OVA

### ISO

### å…¬æœ‰äº‘

### æ ‘è“æ´¾ï¼

ä½ åƒç°çš„æ ‘è“æ´¾åˆæœ‰ç”¨é€”å•¦ï¼ŒPhoton OS ç«Ÿç„¶ä¹Ÿæ”¯æŒæ ‘è“æ´¾ğŸ˜‚ã€‚

## ç³»ç»Ÿæ¦‚å†µ

### systemd å¤§æ³•å¥½ï¼

### å†…å­˜å ç”¨

### ç£ç›˜å ç”¨

### è¿›ç¨‹

## ç½‘ç»œç®¡ç†

## é•œåƒæº

## è¿è¡Œå®¹å™¨

## å‚è€ƒ

-   [New GKE Dataplane V2 increases security and visibility for containers](https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine)
-   [è¢« Google é€‰æ‹©çš„ä¸‹ä¸€ä»£æ•°æ®é¢ Cilium æ˜¯ä»€ä¹ˆ](https://moelove.info/2020/09/02/%E8%A2%AB-Google-%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E4%B8%80%E4%BB%A3%E6%95%B0%E6%8D%AE%E9%9D%A2-Cilium-%E6%98%AF%E4%BB%80%E4%B9%88/)
-   